# feat: 添加高级选项面板和语音输入静音功能

## 📋 概述

本次 PR 为 QAA AirType 添加了高级选项面板和语音输入时自动静音系统功能，大幅提升了用户体验和功能可配置性。

## ✨ 主要功能

### 1. 高级选项面板 (Advanced Options Panel)

新增了可折叠的高级选项面板，用户可以通过点击 "⚙️ 高级选项" 来展开/收起配置面板。面板包含以下配置项：

#### 基础配置
- **自动发送**: 开启后输入文字自动发送，无需点击发送按钮
- **防抖延迟**: 开启后输入延迟 500ms 再发送，避免频繁发送
- **清空两端空白**: 发送前自动去除文本首尾空格
- **展示历史记录**: 显示最近 10 条输入记录，支持快速重发

#### 界面配置
- **使用较大的文本输入框**: 将单行输入框切换为多行文本域，适合长文本输入
- **显示上次发送的文本**: 在输入框上方显示最近一次发送的文本内容，方便确认
- **移除标题**: 当启用"显示上次发送的文本"时，自动隐藏页面标题以节省空间

#### 功能按钮配置
- **提供 Enter 按钮**: 可选的 Enter 按钮，用于发送回车信号
- **提供 Backspace 按钮**: 可选的 Backspace 按钮，用于发送删除信号
- **提供 Undo 按钮**: 可选的 Undo 按钮，用于发送撤销信号 (Ctrl+Z)

#### 高级配置
- **发送前在末尾追加空格**: 在发送的文本末尾自动追加一个空格，适合多句长文本输入场景

### 2. 语音输入时自动静音功能 (Experimental Auto Mute)

新增了实验性的自动静音功能，专门用于解决语音输入时的音频反馈问题：

#### 功能特点
- **自动静音**: 当检测到语音输入开始时，自动将系统音量静音
- **自动恢复**: 输入完成后自动恢复原始音量状态
- **状态保持**: 即使发生错误，也会确保恢复原始静音状态
- **优雅降级**: 如果依赖库未安装，功能会被禁用并显示警告信息

#### 技术实现
- 使用 Windows COM 接口（通过 `pycaw`）控制系统音频
- 访问 `IAudioEndpointVolume` 接口进行静音控制
- 支持无 OSD（屏幕显示）的静音操作
- 提供备用方案（会显示音量条）作为降级处理

#### 依赖要求
```bash
pip install pycaw comtypes pywin32
```

#### 使用说明
1. 在手机端网页界面点击 "⚙️ 高级选项"
2. 启用 "实验性: 输入时自动静音系统"
3. 设置会自动保存到本地存储并与服务器同步

## 📝 详细变更

### 提交历史

1. **feat: 添加高级选项面板** (`eff8b1a`)
   - 新增高级选项面板 UI 组件
   - 实现配置项的本地存储和同步
   - 添加配置项的应用逻辑
   - 代码变更: +591 行

2. **feat: 添加语音输入时系统静音功能** (`550eea7`)
   - 实现 Windows 系统音量控制功能
   - 添加 `/mute` 和 `/mute_immediate` API 端点
   - 创建 `AUTO_MUTE_FEATURE.md` 功能文档
   - 代码变更: +233 行

3. **feat: 优化界面显示和添加高级配置选项** (`76d5f9a`)
   - 优化界面布局和显示逻辑
   - 添加"显示上次发送的文本"功能
   - 移除标题显示选项
   - 添加"发送前在末尾追加空格"配置
   - 代码变更: +169 行

4. **feat: 将显示上次输入的开关添加到高级选项中** (`3333acc`)
   - 将"显示上次发送的文本"功能整合到高级选项面板
   - 优化功能开关逻辑
   - 代码变更: +28 行

### 文件变更统计

- **新增文件**: 1 个
  - `AUTO_MUTE_FEATURE.md`: 自动静音功能文档

- **修改文件**: 1 个
  - `src/remote_server.py`: 主要功能实现
    - 新增: 978 行
    - 删除: 18 行
    - 净增: 960 行

## 🎯 解决的问题

1. **配置项分散**: 之前配置项较少且分散，现在统一整合到高级选项面板
2. **语音输入干扰**: 解决了语音输入时系统音频可能产生的反馈和回声问题
3. **界面信息不足**: 添加了"显示上次发送的文本"功能，方便用户确认输入内容
4. **输入体验**: 提供了更多可选的输入方式（Enter、Backspace、Undo 按钮）

## 🔧 技术细节

### 配置持久化
- 所有配置项使用 `localStorage` 保存在客户端
- 配置变更会同步到服务器端
- 页面刷新后自动恢复配置

### 静音功能实现
- 优先使用 `pycaw` 库进行无 OSD 静音
- 如果 `pycaw` 不可用，回退到 Windows API 按键方式（会显示音量条）
- 使用状态标志确保静音/恢复的正确性

### 界面响应式设计
- 高级选项面板使用折叠/展开动画
- 配置项使用 iOS 风格的开关组件
- 支持动态显示/隐藏功能按钮

## ⚠️ 注意事项

1. **自动静音功能为实验性功能**，目前仅支持 Windows 系统
2. 使用自动静音功能需要安装额外依赖：`pip install pycaw comtypes pywin32`
3. 如果依赖库未安装，功能会被禁用，但不会影响其他功能的使用
4. 所有配置项都有合理的默认值，新用户无需配置即可使用

## 🧪 测试建议

1. **高级选项面板**
   - [ ] 测试所有配置项的开关功能
   - [ ] 验证配置的持久化（刷新页面后配置保持）
   - [ ] 测试不同配置组合的效果

2. **自动静音功能**（Windows 系统）
   - [ ] 安装依赖后测试静音/恢复功能
   - [ ] 测试未安装依赖时的降级处理
   - [ ] 验证语音输入时的静音时机

3. **界面显示**
   - [ ] 测试"显示上次发送的文本"功能
   - [ ] 验证标题隐藏/显示逻辑
   - [ ] 测试大输入框切换功能

## 📚 相关文档

- 自动静音功能详细文档: `AUTO_MUTE_FEATURE.md`

## 🔗 相关 Issue

（如果有相关的 issue，请在这里添加链接）

---

**总计变更**: +1016 行代码，-18 行代码

